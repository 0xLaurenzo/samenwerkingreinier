#include <iostream>
#include <cassert>
#include <fstream>
#include <vector>

using namespace std;

struct Gifts {
    int price;
    string item;
};



istream& operator>> (istream& in, Gifts& gifts){
    char c;
    in >> gifts.price;
    in.get(c);
    getline(in, gifts.item);
    return in;
}

void enter_filename(ifstream& file){
    //preconditions:
    assert(true);
    //postconditions: allows the user to enter a filename of a wishlist and opens this wishlist.
    string filename;
    cout << "enter a filename of a wishlist: ";
    cin >> filename;
    file.open(filename);
}

int  read_gift_store(vector<Gifts>& items){
    //preconditions:
    assert(items.empty());
    //postconditions:opens and reads the giftstore file.
    ifstream file;
    file.open("giftstore.txt");
    if (!file.is_open()){
        return 1;
    }
    while (file) {
        Gifts gift;
        file >> gift;
        if (gift.item != ""){
            items.push_back(gift);
        }
    }
    return 0;
}

int read_wishlist(vector<string>& items, ifstream& file, int& budget){
    //preconditions:
    assert(items.empty());
    //preconditions reads the budget and items in the wishlist and places them in a vector
    if (!file.is_open()){
        return 1;
    }
    string c;
    file >> budget;
    getline(file, c);
    while (file){
        string wish;
        getline(file, wish);
        if (wish != "") {
            items.push_back(wish);
        }
    }
    return 0;
}

int gifts_first_to_fit(vector<string>wishlist, int& budget, vector<Gifts>store, int wishlist_index, int& total_price){
    // preconditions
    assert(wishlist_index >= 0);
    // postconditions: This function iterates recursively through the wishlist and and checks for each item if the budget
    // is lower than the price corresponding item from the store. If it is, the budget and the total price are adjusted
    // There are two base cases in this function. one returns 0 and one returns 1. The base case that returns 1 should
    // never be reached
    if (budget < 0) {
        cout << "budget is lower than 0\n" << total_price << " is the total price\n";
        return  1;
    }
    if (wishlist_index > wishlist.size()){
        cout << wishlist_index << endl;
        return 0;
    }
    for (int i = 0; i < store.size() - 1; i++){
        if (wishlist[wishlist_index] == store[i].item && budget > store[i].price){
            cout << "The old budget is: "<< budget;
            budget -= store[i].price;
            total_price += store[i].price;
            cout << "The new budget is:\t" << budget << endl;
            cout << "The total price is:\t" << total_price << endl;
        }
    }
    gifts_first_to_fit(wishlist, budget, store, wishlist_index + 1, total_price);
}
void wishlist_clean_up(vector<string>& wishlist){
    for (int i; i < wishlist.size(); i++){
        if (wishlist[i] == "")
            wishlist.erase(wishlist.begin() + i);
    }
}
void wishlist_pricing(vector<string> wishlist, vector<Gifts> store, vector<int>& pricing){
    for (int i = 0; i < wishlist.size(); i++) {
        for (int j = 0; j < store.size(); j++) {
            if (wishlist[i] == store[j].item){
                pricing.push_back(store[j].price);
            }
        }
    }
}


int gifts(vector<string> wishlist, vector<int> prices,vector<string>& gifts_given, int wishlist_index, int& total_price, int budget) {
    int current_price = 0;
    vector<string> current_gifts;
    if (wishlist_index == wishlist.size()) {
        return 0;
    }
    current_price += prices[wishlist_index];
    current_gifts.push_back(wishlist[wishlist_index]);
    for (int i = 0; i < wishlist_index; i++) {
        if (current_price + prices[i] <= budget) {
            current_price += prices[i];
            current_gifts.push_back(wishlist[i]);
        }
    }
    for (int i = wishlist_index; i < wishlist.size(); i++) {
        if (current_price + prices[i] <= budget) {
            current_price += prices[i];
            current_gifts.push_back(wishlist[i]);
        }
    }
    if (current_price > total_price && current_price <= budget) {
        total_price = current_price;
        while (!gifts_given.empty()){
            gifts_given.pop_back();
        }
    }
    cout << total_price << endl;
    gifts(wishlist, prices, gifts_given, wishlist_index + 1, total_price, budget);
}

int main() {
    ifstream wishlist_file;
    vector<string> wishlist;
    vector<Gifts> store;
    vector<int> prices;
    vector<string> gifts_to_be_given;
    int budget = 0;
    int total_price = 0;
    enter_filename(wishlist_file);
    read_gift_store(store);
    read_wishlist(wishlist, wishlist_file, budget);
    wishlist_clean_up(wishlist);
    wishlist_pricing(wishlist, store, prices);
    cout << wishlist.size() << endl;
    cout << prices.size() << endl;
    cout << budget << endl;
    cout << gifts(wishlist, prices, gifts_to_be_given, 0, total_price, budget) << endl;
    cout << total_price;
    return 0;
}
